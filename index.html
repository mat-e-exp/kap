<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAP - Knowledge Assessment Platform</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>KAP</h1>
            <p class="subtitle">Knowledge Assessment Platform</p>
            <p class="beta-notice">BETA - Sentiment analysis is experimental</p>
        </header>

        <main>
            <!-- Setup Screen -->
            <div id="setup-screen" class="screen active">
                <div class="card">
                    <h2>Test Your Knowledge</h2>
                    <p>Enter any subject, select a difficulty level, and answer questions while we track your confidence.</p>

                    <div class="input-tabs">
                        <button type="button" class="tab-btn active" data-tab="subject">Subject</button>
                        <button type="button" class="tab-btn" data-tab="document">Document</button>
                    </div>

                    <div id="subject-tab" class="tab-content active">
                        <div class="subject-selection">
                            <label for="subject-input">Subject</label>
                            <div class="subject-input-row">
                                <input type="text" id="subject-input" placeholder="e.g., React, Contract Law, Cardiology..." />
                                <button type="button" id="suggest-btn" class="btn-secondary">Suggest Topics</button>
                            </div>
                            <div id="suggestions-container" class="suggestions-container hidden">
                                <div id="suggestions-list" class="suggestions-list"></div>
                            </div>
                        </div>
                    </div>

                    <div id="document-tab" class="tab-content">
                        <div class="subject-selection">
                            <label for="document-input">Paste Document Text</label>
                            <textarea id="document-input" placeholder="Paste job description, CV, study material, or any document..." rows="6"></textarea>
                            <button type="button" id="analyze-btn" class="btn-secondary" style="margin-top: 0.5rem; width: 100%;">Analyze Document</button>
                        </div>
                        <div id="document-analysis" class="document-analysis hidden">
                            <div class="analysis-result">
                                <span class="analysis-label">Detected:</span>
                                <span id="detected-type" class="detected-type"></span>
                            </div>
                            <p id="analysis-context" class="analysis-context"></p>
                        </div>
                    </div>

                    <div class="subject-selection">
                        <label for="difficulty-select">Difficulty Level</label>
                        <select id="difficulty-select">
                            <option value="1">Level 1 - Beginner</option>
                            <option value="2">Level 2 - Junior</option>
                            <option value="3" selected>Level 3 - Mid-level</option>
                            <option value="4">Level 4 - Senior</option>
                            <option value="5">Level 5 - Expert</option>
                        </select>
                    </div>

                    <div class="subject-selection">
                        <label for="questions-select">Number of Questions</label>
                        <select id="questions-select">
                            <option value="1">1</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="10">10</option>
                            <option value="15">15</option>
                            <option value="20">20</option>
                        </select>
                    </div>

                    <div class="requirements">
                        <div class="requirement" id="camera-status">
                            <span class="icon">ðŸ“·</span>
                            <span>Camera access required</span>
                        </div>
                        <div class="requirement" id="mic-status">
                            <span class="icon">ðŸŽ¤</span>
                            <span>Microphone access required</span>
                        </div>
                    </div>
                    <button id="start-btn" class="btn-primary">Begin Interview</button>
                    <p class="disclaimer">Questions generated by AI. Answers evaluated for correctness and confidence.</p>
                </div>
            </div>

            <!-- Analysis Screen -->
            <div id="analysis-screen" class="screen">
                <div class="analysis-layout">
                    <div class="video-container">
                        <video id="video" autoplay muted playsinline></video>
                        <canvas id="overlay"></canvas>
                        <div class="expression-indicator" id="expression-indicator">
                            <span id="current-expression">Neutral</span>
                        </div>
                    </div>

                    <div class="analysis-panel">
                        <div class="question-container">
                            <div class="question-header">
                                <div class="question-number">Question <span id="question-num">1</span> of <span id="question-total">5</span></div>
                                <div class="question-timer" id="question-timer">0:00</div>
                            </div>
                            <h2 id="question-text">Loading...</h2>
                        </div>

                        <div class="response-container">
                            <div class="listening-indicator" id="listening-indicator">
                                <div class="pulse"></div>
                                <span>Listening...</span>
                            </div>
                            <p id="transcript" class="transcript">Your response will appear here...</p>
                        </div>

                        <div class="metrics">
                            <div class="metric">
                                <label>Confidence Level</label>
                                <div class="meter">
                                    <div class="meter-fill" id="confidence-meter"></div>
                                </div>
                                <span id="confidence-value">0%</span>
                            </div>
                            <div class="metric">
                                <label>Stress Indicators</label>
                                <div class="meter">
                                    <div class="meter-fill stress" id="stress-meter"></div>
                                </div>
                                <span id="stress-value">0%</span>
                            </div>
                        </div>

                        <div class="button-row">
                            <button id="reset-btn" class="btn-secondary">Reset Answer</button>
                            <button id="next-btn" class="btn-primary">Next Question</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Evaluating Screen -->
            <div id="evaluating-screen" class="screen">
                <div class="card">
                    <h2>Evaluating Your Answers</h2>
                    <p>Please wait while we analyse your responses...</p>
                    <div class="eval-progress">
                        <div class="eval-status" id="eval-status">Evaluating question 1 of 5...</div>
                        <div class="meter">
                            <div class="meter-fill" id="eval-progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="results-screen" class="screen">
                <div class="card results-card">
                    <h2>Analysis Complete</h2>
                    <div class="verdict" id="verdict">
                        <div class="verdict-score" id="verdict-score">0%</div>
                        <div class="verdict-label" id="verdict-label">Overall Score</div>
                    </div>
                    <div class="breakdown">
                        <h3>Session Breakdown</h3>
                        <div id="question-breakdown"></div>
                    </div>
                    <button id="restart-btn" class="btn-primary">Start New Session</button>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api@1.7.12/dist/face-api.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
    <script src="app.js"></script>
</body>
</html>
